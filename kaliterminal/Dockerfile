# syntax=docker/dockerfile:1
FROM kalilinux/kali-rolling@sha256:273be175b2e5c3c88f715aae949847f1dc2df8e5ea40bc4c8eab4fa9afffe3d2 as base

FROM base as firefox_get
RUN apt-get update && apt-get -y install wget bzip2 \
	&& \
	wget -O firefox.tar.bz2 "https://download.mozilla.org/?product=firefox-latest&os=linux64&lang=en-US" \
	&& \
	tar xvjf firefox.tar.bz2 \
	&& \
	apt-get clean

FROM base as aws_v2_cli_get
RUN apt-get update && apt-get -y install unzip wget \
	&& \
	wget -O awscliv2.zip https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.3.0.zip \
	&& \
	unzip awscliv2.zip \
	&& \
	apt-get clean

FROM base as burpsuite_get
RUN apt-get update && apt-get -y install unzip wget \
	&& \
	wget -O burpsuite_community_linux "https://portswigger.net/burp/releases/download?product=community&version=2021.8.2&type=Linux" \
	&& \
	chmod +x burpsuite_community_linux \
	&& \
	apt-get clean


FROM base as dep_install
	RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get -y install \
	bash-completion \
	coreutils \
	cl-base64 \
	dnsutils \
	hydra-gtk \
	iputils-ping \
	jq \
	less \
	libcap2-bin \
	libdbus-glib-1-2 \
	macchanger \ 
	medusa \
	metasploit-framework \
	nano \
	netcat-openbsd \
	net-tools \
	nmap \
	openjdk-11-jre \
	python3-minimal \
	python3-pip \
	tshark \
	wireshark \
	&& apt-get clean


FROM dep_install as python_deps_install
RUN pip3 install --no-cache lambdaguard \
	&& \
	pip3 install scapy[basic]

FROM python_deps_install as artifact_transfer
COPY  --from=aws_v2_cli_get /aws ./aws
COPY  --from=burpsuite_get /burpsuite_community_linux .
COPY  --from=firefox_get /firefox ./firefox

FROM artifact_transfer as artifact_installation
RUN ./aws/install -i /usr/local/aws-cli -b /usr/local/bin \
	&& \
	yes "" | ./burpsuite_community_linux -c \ 
	&& rm -R aws burpsuite_community_linux


FROM artifact_installation as bash_configuration
RUN echo '#!/bin/bash\n echo $(./usr/local/BurpSuiteCommunity/BurpSuiteCommunity &)' > /usr/bin/burpsuite && chmod +x /usr/bin/burpsuite \
	&& \
	echo '#!/bin/bash\n echo $(./firefox/firefox &)' > /usr/bin/firefox && chmod +x /usr/bin/firefox
